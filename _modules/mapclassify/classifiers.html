<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mapclassify.classifiers &#8212; mapclassify v2.10.0 Manual</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=9afac83c" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/pysal-styles.css?v=0c2123f2" />
    <script src="../../_static/documentation_options.js?v=67920a36"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../../_static/pysal_favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          mapclassify</a>
        <span class="navbar-text navbar-version pull-left"><b>2.10.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../installation.html">Installation</a></li>
                <li><a href="../../tutorial.html">Tutorial</a></li>
                <li><a href="../../api.html">API</a></li>
                <li><a href="../../references.html">References</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#installing-released-version">Installing released version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#installing-development-version">Installing development version</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/01_maximum_breaks.html">Introduction to mapclassify</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/02_legends.html">Legends in mapclassify</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/03_choropleth.html">Choropleth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/04_pooled.html">Pooled Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/05_Greedy_coloring.html">Getting started with mapclassify.greedy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/06_api.html">Overview of the mapclassify API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/06_api.html#Original-API-(&lt;-2.4.0)">Original API (&lt; 2.4.0)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/06_api.html#Extended-API-(&gt;=-2.40)">Extended API (&gt;= 2.40)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/09_legendgram.html">Using legendgram as a map legend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notebooks/value_by_alpha.html">Value-by-Alpha Choropleth</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#classifiers">Classifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#utilities">Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for mapclassify.classifiers</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module of classification schemes for choropleth mapping.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.legendgram</span><span class="w"> </span><span class="kn">import</span> <span class="n">_legendgram</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Sergio J. Rey&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;MapClassifier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quantile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BoxPlot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EqualInterval&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FisherJenks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FisherJenksSampled&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JenksCaspall&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JenksCaspallForced&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JenksCaspallSampled&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HeadTailBreaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MaxP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MaximumBreaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NaturalBreaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Quantiles&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Percentiles&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PrettyBreaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;StdMean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UserDefined&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gadf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KClassifiers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CLASSIFIERS&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">CLASSIFIERS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;BoxPlot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EqualInterval&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FisherJenks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FisherJenksSampled&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HeadTailBreaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JenksCaspall&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JenksCaspallForced&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JenksCaspallSampled&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MaxP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MaximumBreaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NaturalBreaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Quantiles&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Percentiles&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PrettyBreaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;StdMean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UserDefined&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">K</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># default number of classes in any map scheme with this as an argument</span>
<span class="n">SEEDRANGE</span> <span class="o">=</span> <span class="mi">1000000</span>  <span class="c1"># range for drawing random ints from for Natural Breaks</span>


<span class="n">FMT</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">njit</span>

    <span class="n">HAS_NUMBA</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HAS_NUMBA</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">njit</span><span class="p">(</span><span class="n">_type</span><span class="p">):</span>  <span class="c1"># noqa ARG001</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">decorator_njit</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">wrapper_decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">wrapper_decorator</span>

        <span class="k">return</span> <span class="n">decorator_njit</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_format_intervals</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper methods to format legend intervals.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    mc: MapClassifier</span>
<span class="sd">    fmt: str (default &#39;{:.0f}&#39;)</span>
<span class="sd">        Specification of formatting for legend.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    tuple:</span>
<span class="sd">        edges : list</span>
<span class="sd">            :math:`k` strings for class intervals.</span>
<span class="sd">        max_width : int</span>
<span class="sd">            Length of largest interval string.</span>
<span class="sd">        lower_open : bool</span>
<span class="sd">            True: lower bound of first interval is open.</span>
<span class="sd">            False: lower bound of first interval is closed.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    For some classifiers, it is possible that the upper bound of the first</span>
<span class="sd">    interval is less than the minimum value of the attribute that is being</span>
<span class="sd">    classified. In these cases ``lower_open=True`` and the lower bound of the</span>
<span class="sd">    interval is set to ``numpy.NINF``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lowest</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="s2">&quot;lowest&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mc</span><span class="o">.</span><span class="n">lowest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lowest</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">lowest</span>
    <span class="n">lower_open</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">lowest</span> <span class="o">&gt;</span> <span class="n">mc</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">lowest</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">lower_open</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">lowest</span><span class="p">]</span>
    <span class="n">edges</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
    <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">edges</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">lower_open</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_mpl_labels</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2">&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper method to format legend intervals for matplotlib (and geopandas).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    mc : MapClassifier</span>
<span class="sd">    fmt : str (default &#39;{:.1f}&#39;)</span>
<span class="sd">        Specification of formatting for legend.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    intervals : list</span>
<span class="sd">        :math:`k` strings for class intervals.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">lower_open</span> <span class="o">=</span> <span class="n">_format_intervals</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">left</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;[&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">lower_open</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;(&quot;</span><span class="p">]</span>
    <span class="n">left</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">right</span> <span class="o">=</span> <span class="s2">&quot;]&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;{:&gt;</span><span class="si">{width}</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">max_width</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;{:&gt;</span><span class="si">{width}</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">max_width</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">_l</span> <span class="o">+</span> <span class="n">r</span> <span class="k">for</span> <span class="n">_l</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="n">_l</span> <span class="o">+</span> <span class="n">r</span> <span class="k">for</span> <span class="n">_l</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="n">intervals</span> <span class="o">=</span> <span class="p">[</span><span class="n">_l</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">r</span> <span class="k">for</span> <span class="n">_l</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">intervals</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_table</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to generate tabular classification report.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    mc: MapClassifier</span>
<span class="sd">    fmt: str (default &#39;{:.2f}&#39;)</span>
<span class="sd">        specification of formatting for legend.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    table : str</span>
<span class="sd">        Formatted table of classification results.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">intervals</span> <span class="o">=</span> <span class="n">_get_mpl_labels</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="n">interval_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">counts</span><span class="p">))</span>
    <span class="n">count_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">])</span>
    <span class="n">count_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">count_width</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">))</span>
    <span class="n">interval_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">interval_width</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">))</span>
    <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Interval&#39;</span><span class="si">:</span><span class="s2"> ^</span><span class="si">{</span><span class="n">interval_width</span><span class="si">}}</span><span class="s2">&quot;</span>
    <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Count&#39;</span><span class="si">:</span><span class="s2"> &gt;</span><span class="si">{</span><span class="n">count_width</span><span class="si">}}</span><span class="s2">&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">name</span>
    <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">title</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">header</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">interval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2"> &gt;</span><span class="si">{</span><span class="n">count_width</span><span class="si">}}</span><span class="s2">&quot;</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">head_tail_breaks</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">cuts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Head tail breaks helper function.&quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cuts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cuts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">mean</span><span class="p">:</span>  <span class="c1"># this fixes floating point from GH#117</span>
        <span class="k">return</span> <span class="n">cuts</span>
    <span class="n">cuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">head_tail_breaks</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">values</span> <span class="o">&gt;</span> <span class="n">mean</span><span class="p">],</span> <span class="n">cuts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cuts</span>


<span class="k">def</span><span class="w"> </span><span class="nf">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the quantiles for an array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 4)</span>
<span class="sd">        Number of quantiles.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    q : numpy.array</span>
<span class="sd">        :math:`(n,1)`, quantile values.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    If there are enough ties that the quantile values repeat, we collapse to</span>
<span class="sd">    pseudo quantiles in which case the number of classes will be less than ``k``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; x = numpy.arange(1000)</span>

<span class="sd">    &gt;&gt;&gt; mapclassify.classifiers.quantile(x)</span>
<span class="sd">    array([249.75, 499.5 , 749.25, 999.  ])</span>

<span class="sd">    &gt;&gt;&gt; mapclassify.classifiers.quantile(x, k=3)</span>
<span class="sd">    array([333., 666., 999.])</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">w</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">k</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">100.0</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pct</span><span class="p">)</span> <span class="k">for</span> <span class="n">pct</span> <span class="ow">in</span> <span class="n">p</span><span class="p">])</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">k_q</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k_q</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Not enough unique values in array to form </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> classes. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Setting k to </span><span class="si">{</span><span class="n">k_q</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">q</span>


<span class="k">def</span><span class="w"> </span><span class="nf">binC</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>  <span class="c1"># noqa N802</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin categorical/qualitative data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,q)`, categorical values.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, unique values associated with each bin.</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>

<span class="sd">    b : numpy.array</span>
<span class="sd">        :math:`(n,q)` bin membership, values between ``0`` and ``k-1``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; numpy.random.seed(1)</span>
<span class="sd">    &gt;&gt;&gt; x = numpy.random.randint(2, 8, (10, 3))</span>
<span class="sd">    &gt;&gt;&gt; bins = list(range(2, 8))</span>
<span class="sd">    &gt;&gt;&gt; x</span>
<span class="sd">    array([[7, 5, 6],</span>
<span class="sd">           [2, 3, 5],</span>
<span class="sd">           [7, 2, 2],</span>
<span class="sd">           [3, 6, 7],</span>
<span class="sd">           [6, 3, 4],</span>
<span class="sd">           [6, 7, 4],</span>
<span class="sd">           [6, 5, 6],</span>
<span class="sd">           [4, 6, 7],</span>
<span class="sd">           [4, 6, 3],</span>
<span class="sd">           [3, 2, 7]])</span>

<span class="sd">    &gt;&gt;&gt; y = mapclassify.classifiers.binC(x, bins)</span>
<span class="sd">    &gt;&gt;&gt; y</span>
<span class="sd">    array([[5, 3, 4],</span>
<span class="sd">           [0, 1, 3],</span>
<span class="sd">           [5, 0, 0],</span>
<span class="sd">           [1, 4, 5],</span>
<span class="sd">           [4, 1, 2],</span>
<span class="sd">           [4, 5, 2],</span>
<span class="sd">           [4, 3, 4],</span>
<span class="sd">           [2, 4, 5],</span>
<span class="sd">           [2, 4, 1],</span>
<span class="sd">           [1, 0, 5]])</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: consider renaming ``binC`` to ``bin_c`` to resolve N802 (gh#185)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
        <span class="n">b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="n">_bin</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="c1"># check for non-binned items and warn if needed</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Value not in bin: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="se">\n</span><span class="s2">Bins: </span><span class="si">{</span><span class="n">bins</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">b</span>


<span class="k">def</span><span class="w"> </span><span class="nf">bin</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>  <span class="c1"># noqa A001</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin interval/ratio data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,q)`, values to bin.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, upper bounds of each bin (monotonic).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    b : numpy.array</span>
<span class="sd">        :math:`(n,q)`, values of values between ``0`` and ``k-1``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; numpy.random.seed(1)</span>
<span class="sd">    &gt;&gt;&gt; x = numpy.random.randint(2, 20, (10, 3))</span>
<span class="sd">    &gt;&gt;&gt; bins = [10, 15, 20]</span>
<span class="sd">    &gt;&gt;&gt; b = mapclassify.classifiers.bin(x, bins)</span>
<span class="sd">    &gt;&gt;&gt; x</span>
<span class="sd">    array([[ 7, 13, 14],</span>
<span class="sd">           [10, 11, 13],</span>
<span class="sd">           [ 7, 17,  2],</span>
<span class="sd">           [18,  3, 14],</span>
<span class="sd">           [ 9, 15,  8],</span>
<span class="sd">           [ 7, 13, 12],</span>
<span class="sd">           [16,  6, 11],</span>
<span class="sd">           [19,  2, 15],</span>
<span class="sd">           [11, 11,  9],</span>
<span class="sd">           [ 3,  2, 19]])</span>

<span class="sd">    &gt;&gt;&gt; b</span>
<span class="sd">    array([[0, 1, 1],</span>
<span class="sd">           [0, 1, 1],</span>
<span class="sd">           [0, 2, 0],</span>
<span class="sd">           [2, 0, 1],</span>
<span class="sd">           [0, 1, 0],</span>
<span class="sd">           [0, 1, 1],</span>
<span class="sd">           [2, 0, 1],</span>
<span class="sd">           [2, 0, 1],</span>
<span class="sd">           [1, 1, 0],</span>
<span class="sd">           [0, 0, 2]])</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: consider renaming ``bin`` to ``bin_int`` to resolve A001 (gh#185)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">binsc</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">binsc</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">binsc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">b</span>


<span class="k">def</span><span class="w"> </span><span class="nf">bin1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Place values of a 1-d array into bins and determine</span>
<span class="sd">    counts of values in each bin.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    x : numpy.array</span>
<span class="sd">        :math:`(n, 1)`, values to bin.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, upper bounds of each bin (monotonic).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    bin_ids : numpy.array</span>
<span class="sd">        1-d array of integer bin IDs.</span>
<span class="sd">    counts : int</span>
<span class="sd">        Number of elements of ``x`` falling in each bin.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; x = numpy.arange(100, dtype = &quot;float&quot;)</span>
<span class="sd">    &gt;&gt;&gt; bins = [25, 74, 100]</span>
<span class="sd">    &gt;&gt;&gt; bin_ids, counts = mapclassify.classifiers.bin1d(x, bins)</span>
<span class="sd">    &gt;&gt;&gt; bin_ids</span>
<span class="sd">    array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span>
<span class="sd">           0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,</span>
<span class="sd">           1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,</span>
<span class="sd">           1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,</span>
<span class="sd">           2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2])</span>

<span class="sd">    &gt;&gt;&gt; counts.tolist()</span>
<span class="sd">    [26, 49, 25]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span>
    <span class="n">left</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">bins</span>
    <span class="n">cuts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">bin_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">cuts</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">_l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">cuts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bin_ids</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">_l</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">bin_ids</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">bin_ids</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_pretty_number</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
    <span class="k">if</span> <span class="n">rounded</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="k">elif</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mf">7.0</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="k">elif</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="mf">5.0</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="mf">10.0</span>

    <span class="k">return</span> <span class="n">nf</span> <span class="o">*</span> <span class="mf">10.0</span><span class="o">**</span><span class="n">exp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_pretty</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">rg</span> <span class="o">=</span> <span class="n">_pretty_number</span><span class="p">(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">_pretty_number</span><span class="p">(</span><span class="n">rg</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">low</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">high</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for doc tests</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">calemp</span>

    <span class="k">return</span> <span class="n">calemp</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_kmeans</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to do k-means in one dimension.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int, (default 5)</span>
<span class="sd">        Number of classes to form.</span>
<span class="sd">    n_init : int, (default 10)</span>
<span class="sd">        Number of initial  solutions. Best of initial results is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="mf">1.0</span>  <span class="c1"># sklearn.cluster.KMeans needs float or double dtype</span>
    <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s2">&quot;k-means++&quot;</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="n">n_init</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">class_ids</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">labels_</span>
    <span class="n">centroids</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">cluster_centers_</span>
    <span class="n">binning</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">class_ids</span> <span class="o">==</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">binning</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)])</span>
    <span class="n">binning</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">binning</span><span class="p">)</span>
    <span class="n">binning</span> <span class="o">=</span> <span class="n">binning</span><span class="p">[</span><span class="n">binning</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
    <span class="n">cuts</span> <span class="o">=</span> <span class="n">binning</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">y_cent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">y_cent</span><span class="p">[</span><span class="n">class_ids</span> <span class="o">==</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroids</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="n">diffs</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_cent</span>
    <span class="n">diffs</span> <span class="o">*=</span> <span class="n">diffs</span>

    <span class="k">return</span> <span class="n">class_ids</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">diffs</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">centroids</span>


<span class="k">def</span><span class="w"> </span><span class="nf">natural_breaks</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Natural breaks helper function. Jenks natural breaks is k-means in one dimension.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    values : numpy.array</span>
<span class="sd">        :math:`(n, 1)` values to bin.</span>
<span class="sd">    k : int, (default 5)</span>
<span class="sd">        Number of classes.</span>
<span class="sd">    init: int, (default 10)</span>
<span class="sd">        Number of different solutions to obtain using different centroids.</span>
<span class="sd">        Best solution is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">uv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">uvk</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">uvk</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Not enough unique values in array to form </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> classes. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Setting k to </span><span class="si">{</span><span class="n">uvk</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">uvk</span>
    <span class="n">kres</span> <span class="o">=</span> <span class="n">_kmeans</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="n">init</span><span class="p">)</span>
    <span class="n">sids</span> <span class="o">=</span> <span class="n">kres</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># centroids</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">kres</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">class_ids</span> <span class="o">=</span> <span class="n">kres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cuts</span> <span class="o">=</span> <span class="n">kres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">sids</span><span class="p">,</span> <span class="n">class_ids</span><span class="p">,</span> <span class="n">fit</span><span class="p">,</span> <span class="n">cuts</span><span class="p">)</span>


<span class="nd">@njit</span><span class="p">(</span><span class="s2">&quot;f8[:](f8[:], u2)&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_fisher_jenks_means</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Jenks Optimal (Natural Breaks) algorithm implemented in Python.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The original Python code comes from here:</span>
<span class="sd">    http://danieljlewis.org/2010/06/07/jenks-natural-breaks-algorithm-in-python/</span>
<span class="sd">    and is based on a JAVA and Fortran code available here:</span>
<span class="sd">    https://stat.ethz.ch/pipermail/r-sig-geo/2006-March/000811.html</span>

<span class="sd">    Returns class breaks such that classes are internally homogeneous while</span>
<span class="sd">    assuring heterogeneity among classes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">mat1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">classes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">mat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">classes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">mat1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">mat2</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">_l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">i3</span> <span class="o">=</span> <span class="n">_l</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">s2</span> <span class="o">+=</span> <span class="n">val</span> <span class="o">*</span> <span class="n">val</span>
            <span class="n">s1</span> <span class="o">+=</span> <span class="n">val</span>
            <span class="n">w</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">-</span> <span class="p">(</span><span class="n">s1</span> <span class="o">*</span> <span class="n">s1</span><span class="p">)</span> <span class="o">/</span> <span class="n">w</span>
            <span class="n">i4</span> <span class="o">=</span> <span class="n">i3</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i4</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">classes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">mat2</span><span class="p">[</span><span class="n">_l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">mat2</span><span class="p">[</span><span class="n">i4</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                        <span class="n">mat1</span><span class="p">[</span><span class="n">_l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i3</span>
                        <span class="n">mat2</span><span class="p">[</span><span class="n">_l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">mat2</span><span class="p">[</span><span class="n">i4</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">mat1</span><span class="p">[</span><span class="n">_l</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mat2</span><span class="p">[</span><span class="n">_l</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="n">kclass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">classes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">kclass</span><span class="p">[</span><span class="n">classes</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">kclass</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">count_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">mat1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">count_num</span><span class="p">]</span>
        <span class="n">_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pivot</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">kclass</span><span class="p">[</span><span class="n">count_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pivot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">kclass</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MapClassifier</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for all map classifications :cite:`Slocum_2009`</span>

<span class="sd">    For an array :math:`y` of :math:`n` values, a map classifier places each</span>
<span class="sd">    value :math:`y_i` into one of :math:`k` mutually exclusive and exhaustive</span>
<span class="sd">    classes.  Each classifer defines the classes based on different criteria,</span>
<span class="sd">    but in all cases the following hold for the classifiers in PySAL:</span>

<span class="sd">    .. math:: C_j^l &lt; y_i \le C_j^u \  \forall  i \in C_j</span>

<span class="sd">    where :math:`C_j` denotes class :math:`j` which has lower bound</span>
<span class="sd">          :math:`C_j^l` and upper bound :math:`C_j^u`.</span>

<span class="sd">    Map Classifiers Supported</span>

<span class="sd">    * :class:`mapclassify.classifiers.BoxPlot`</span>
<span class="sd">    * :class:`mapclassify.classifiers.EqualInterval`</span>
<span class="sd">    * :class:`mapclassify.classifiers.FisherJenks`</span>
<span class="sd">    * :class:`mapclassify.classifiers.FisherJenksSampled`</span>
<span class="sd">    * :class:`mapclassify.classifiers.HeadTailBreaks`</span>
<span class="sd">    * :class:`mapclassify.classifiers.JenksCaspall`</span>
<span class="sd">    * :class:`mapclassify.classifiers.JenksCaspallForced`</span>
<span class="sd">    * :class:`mapclassify.classifiers.JenksCaspallSampled`</span>
<span class="sd">    * :class:`mapclassify.classifiers.MaxP`</span>
<span class="sd">    * :class:`mapclassify.classifiers.MaximumBreaks`</span>
<span class="sd">    * :class:`mapclassify.classifiers.NaturalBreaks`</span>
<span class="sd">    * :class:`mapclassify.classifiers.Quantiles`</span>
<span class="sd">    * :class:`mapclassify.classifiers.Percentiles`</span>
<span class="sd">    * :class:`mapclassify.classifiers.StdMean`</span>
<span class="sd">    * :class:`mapclassify.classifiers.UserDefined`</span>

<span class="sd">    In addition to the classifiers, there are several utility functions that</span>
<span class="sd">    can be used to evaluate the properties of a specific classifier,</span>
<span class="sd">    or for automatic selection of a classifier and number of classes.</span>

<span class="sd">    * :func:`mapclassify.classifiers.gadf`</span>
<span class="sd">    * :class:`mapclassify.classifiers.K_classifiers`</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Map Classifier&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">FMT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classify</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_fmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_fmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span> <span class="o">=</span> <span class="n">fmt</span>

    <span class="n">fmt</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_fmt</span><span class="p">,</span> <span class="n">set_fmt</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">yb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">yb</span> <span class="o">==</span> <span class="n">c</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tss</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adcm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_adcm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gadf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gadf</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_classify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_bins</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">bin1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The only thing that *should* happen in this function is</span>

<span class="sd">        1. input sanitization for pandas</span>
<span class="sd">        2. classification/reclassification.</span>

<span class="sd">        Using their ``__init__`` methods, all classifiers can re-classify given</span>
<span class="sd">        different input parameters or additional data.</span>

<span class="sd">        If you&#39;ve got a cleverer updating equation other than the intial estimation</span>
<span class="sd">        equation, remove the call to ``self.__init__`` below and replace it with</span>
<span class="sd">        the updating function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure and create a classifier that will consume data and produce</span>
<span class="sd">        classifications, given the configuration options specified by this</span>
<span class="sd">        function.</span>

<span class="sd">        Note that this implements a *partial application* of the relevant class</span>
<span class="sd">        constructor. ``make`` creates a function that returns classifications; it</span>
<span class="sd">        does not actually do the classification.</span>

<span class="sd">        If you want to classify data directly, use the appropriate class</span>
<span class="sd">        constructor, like ``Quantiles``, ``Max_Breaks``, etc.</span>

<span class="sd">        If you *have* a classifier object, but want to find which bins new data</span>
<span class="sd">        falls into, use ``find_bin``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        *args : required positional arguments</span>
<span class="sd">            All positional arguments required by the classifier,</span>
<span class="sd">            **excluding** the input data.</span>
<span class="sd">        rolling : bool</span>
<span class="sd">            A boolean configuring the outputted classifier to use</span>
<span class="sd">            a rolling classifier rather than a new classifier for</span>
<span class="sd">            each input. If ``rolling``, this adds the current data to</span>
<span class="sd">            all of the previous data in the classifier, and</span>
<span class="sd">            rebalances the bins, like a running median computation.</span>
<span class="sd">        return_object : bool</span>
<span class="sd">            Return the classifier object (or not).</span>
<span class="sd">        return_bins : bool</span>
<span class="sd">            Return the bins/breaks (or not).</span>
<span class="sd">        return_counts : bool</span>
<span class="sd">            Return the histogram of objects falling into each bin (or not).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        A function that consumes data and returns their bins (and object,</span>
<span class="sd">        bins/breaks, or counts, if requested).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This is most useful when you want to run a classifier many times</span>
<span class="sd">        with a given configuration, such as when classifying many columns of an</span>
<span class="sd">        array or dataframe using the same configuration.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import libpysal</span>
<span class="sd">        &gt;&gt;&gt; import mapclassify</span>
<span class="sd">        &gt;&gt;&gt; import geopandas</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; import pandas</span>
<span class="sd">        &gt;&gt;&gt; df = geopandas.read_file(libpysal.examples.get_path(&quot;columbus.dbf&quot;))</span>
<span class="sd">        &gt;&gt;&gt; classifier = mapclassify.Quantiles.make(k=9)</span>
<span class="sd">        &gt;&gt;&gt; cl = df[[&quot;HOVAL&quot;, &quot;CRIME&quot;, &quot;INC&quot;]].apply(classifier)</span>
<span class="sd">        &gt;&gt;&gt; cl[&quot;HOVAL&quot;].values[:10]</span>
<span class="sd">        array([8, 7, 2, 4, 1, 3, 8, 5, 7, 8])</span>

<span class="sd">        &gt;&gt;&gt; cl[&quot;CRIME&quot;].values[:10]</span>
<span class="sd">        array([0, 1, 3, 4, 6, 2, 0, 5, 3, 4])</span>

<span class="sd">        &gt;&gt;&gt; cl[&quot;INC&quot;].values[:10]</span>
<span class="sd">        array([7, 8, 5, 0, 3, 5, 0, 3, 6, 4])</span>

<span class="sd">        &gt;&gt;&gt; data = [</span>
<span class="sd">        ...     numpy.linspace(3,8,num=10),</span>
<span class="sd">        ...     numpy.linspace(10, 0, num=10),</span>
<span class="sd">        ...     numpy.linspace(-5, 15, num=10)</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; data = pandas.DataFrame(data).T</span>
<span class="sd">        &gt;&gt;&gt; data</span>
<span class="sd">                  0          1          2</span>
<span class="sd">        0  3.000000  10.000000  -5.000000</span>
<span class="sd">        1  3.555556   8.888889  -2.777778</span>
<span class="sd">        2  4.111111   7.777778  -0.555556</span>
<span class="sd">        3  4.666667   6.666667   1.666667</span>
<span class="sd">        4  5.222222   5.555556   3.888889</span>
<span class="sd">        5  5.777778   4.444444   6.111111</span>
<span class="sd">        6  6.333333   3.333333   8.333333</span>
<span class="sd">        7  6.888889   2.222222  10.555556</span>
<span class="sd">        8  7.444444   1.111111  12.777778</span>
<span class="sd">        9  8.000000   0.000000  15.000000</span>

<span class="sd">        &gt;&gt;&gt; data.apply(mapclassify.Quantiles.make(rolling=True))</span>
<span class="sd">           0  1  2</span>
<span class="sd">        0  0  4  0</span>
<span class="sd">        1  0  4  0</span>
<span class="sd">        2  1  4  0</span>
<span class="sd">        3  1  3  0</span>
<span class="sd">        4  2  2  1</span>
<span class="sd">        5  2  1  2</span>
<span class="sd">        6  3  1  4</span>
<span class="sd">        7  3  0  4</span>
<span class="sd">        8  4  0  4</span>
<span class="sd">        9  4  0  4</span>

<span class="sd">        &gt;&gt;&gt; dbf = libpysal.io.open(libpysal.examples.get_path(&quot;baltim.dbf&quot;))</span>
<span class="sd">        &gt;&gt;&gt; data = dbf.by_col_array(&quot;PRICE&quot;, &quot;LOTSZ&quot;, &quot;SQFT&quot;)</span>
<span class="sd">        &gt;&gt;&gt; my_bins = [1, 10, 20, 40, 80]</span>
<span class="sd">        &gt;&gt;&gt; cl = [mapclassify.UserDefined.make(bins=my_bins)(a) for a in data.T]</span>
<span class="sd">        &gt;&gt;&gt; len(cl)</span>
<span class="sd">        3</span>

<span class="sd">        &gt;&gt;&gt; cl[0][:10]</span>
<span class="sd">        array([4, 5, 5, 5, 4, 4, 5, 4, 4, 5])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># only flag overrides return flag</span>
        <span class="n">to_annotate</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">return_object</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;return_object&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">return_bins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;return_bins&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">return_counts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;return_counts&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">rolling</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rolling&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rolling</span><span class="p">:</span>
            <span class="c1">#  just initialize a fake classifier</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">cls_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1">#  and empty it, since we&#39;ll be using the update</span>
            <span class="n">cls_instance</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cls_instance</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#  wrap init in a closure to make a consumer.</span>
        <span class="c1">#  Qc Na: &quot;Objects/Closures are poor man&#39;s Closures/Objects&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">classifier</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cls_instance</span><span class="o">=</span><span class="n">cls_instance</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rolling</span><span class="p">:</span>
                <span class="n">cls_instance</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">yb</span> <span class="o">=</span> <span class="n">cls_instance</span><span class="o">.</span><span class="n">find_bin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cls_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">yb</span> <span class="o">=</span> <span class="n">cls_instance</span><span class="o">.</span><span class="n">yb</span>
            <span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="n">yb</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">outs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls_instance</span> <span class="k">if</span> <span class="n">return_object</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">outs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls_instance</span><span class="o">.</span><span class="n">bins</span> <span class="k">if</span> <span class="n">return_bins</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">outs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls_instance</span><span class="o">.</span><span class="n">counts</span> <span class="k">if</span> <span class="n">return_counts</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">outs</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">outs</span>

        <span class="c1">#  for debugging/jic, keep around the kwargs.</span>
        <span class="c1">#  in future, we might want to make this a thin class, so that we can</span>
        <span class="c1">#  set a custom repr. Call the class `Binner` or something, that&#39;s a</span>
        <span class="c1">#  pre-configured Classifier that just consumes data, bins it, &amp;</span>
        <span class="c1">#  possibly updates the bins.</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="n">to_annotate</span>
        <span class="k">return</span> <span class="n">classifier</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">         y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span>
        <span class="k">return</span> <span class="n">_get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will allow the classifier to be called like it&#39;s a function.</span>

<span class="sd">        Whether or not we want to make this be ``find_bin`` or ``update`` is a</span>
<span class="sd">        design decision.</span>

<span class="sd">        I like this as ``find_bin``, since a classifier&#39;s job should be to classify</span>
<span class="sd">        the data given to it using the rules estimated from the ``_classify()``.</span>
<span class="sd">        function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_bin</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_tss</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns sum of squares over all class means.&quot;&quot;&quot;</span>
        <span class="n">tss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">class_def</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_def</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">yc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">class_def</span><span class="p">]</span>
                <span class="n">css</span> <span class="o">=</span> <span class="n">yc</span> <span class="o">-</span> <span class="n">yc</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">css</span> <span class="o">*=</span> <span class="n">css</span>
                <span class="n">tss</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">css</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tss</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_adcm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Absolute deviation around class median (*ADCM*).</span>

<span class="sd">        Calculates the absolute deviations of each observation about its class</span>
<span class="sd">        median as a measure of fit for the classification method.</span>

<span class="sd">        Returns sum of *ADCM* over all classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">adcm</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">class_def</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_def</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">yc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">class_def</span><span class="p">]</span>
                <span class="n">yc_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">yc</span><span class="p">)</span>
                <span class="n">ycd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yc</span> <span class="o">-</span> <span class="n">yc_med</span><span class="p">)</span>
                <span class="n">adcm</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ycd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">adcm</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_gadf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Goodness of absolute deviation of fit.&quot;&quot;&quot;</span>
        <span class="n">adam</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1"># return 1 if array is invariant</span>
        <span class="n">gadf</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">adam</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">adcm</span> <span class="o">/</span> <span class="n">adam</span>
        <span class="k">return</span> <span class="n">gadf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort input or inputs according to the current bin estimate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        x : numpy.array, int, float</span>
<span class="sd">            A value or array of values to fit within the estimated bins.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        right : numpy.array, int</span>
<span class="sd">            A bin index or array of bin indices that classify the</span>
<span class="sd">            input into one of the classifiers&#39; bins.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This differs from similar functionality in</span>
<span class="sd">        ``numpy.digitize(x, classi.bins, right=True)``.</span>

<span class="sd">        This will always provide the closest bin, so data &quot;outside&quot; the classifier,</span>
<span class="sd">        above and below the max/min breaks, will be classified into the nearest bin.</span>

<span class="sd">        ``numpy.digitize`` returns :math:`k+1` for data greater than the greatest bin,</span>
<span class="sd">        but retains 0 for data below the lowest bin.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">right</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">):</span>
            <span class="n">right</span><span class="p">[</span><span class="n">right</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">right</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_legend_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">FMT</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format the strings for the classes on the legend.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fmt : str (default &#39;{:.2f}&#39;)</span>
<span class="sd">            Formatting specification.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        classes : list</span>
<span class="sd">            :math:`k` strings with class interval definitions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_get_mpl_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gdf</span><span class="p">,</span>
        <span class="n">border_color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>
        <span class="n">border_width</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGnBu&quot;</span><span class="p">,</span>
        <span class="n">axis_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="s2">&quot;fmt&quot;</span><span class="p">:</span> <span class="n">FMT</span><span class="p">},</span>
        <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a mapclassifier object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        gdf : geopandas.GeoDataFrame</span>
<span class="sd">            Contains the geometry column for the choropleth map.</span>
<span class="sd">        border_color  : str (default &#39;lightgray&#39;)</span>
<span class="sd">            Matplotlib color string to use for polygon border.</span>
<span class="sd">        border_width : float (default 0.10)</span>
<span class="sd">            Width of polygon border.</span>
<span class="sd">        title : str (default None)</span>
<span class="sd">            Title of map.</span>
<span class="sd">        cmap : str (default &#39;YlGnBu&#39;)</span>
<span class="sd">            Matplotlib color string for color map to fill polygons.</span>
<span class="sd">        axis_on : bool (default True)</span>
<span class="sd">            Show coordinate axes.</span>
<span class="sd">        legend_kwds : dict (default {&#39;loc&#39;: &#39;lower right&#39;, &#39;fmt&#39;:FMT})</span>
<span class="sd">            Options for ``ax.legend()``.</span>
<span class="sd">        file_name : str (default None)</span>
<span class="sd">            Name of file to save figure to.</span>
<span class="sd">        dpi : int (default 600)</span>
<span class="sd">            Dots per inch for saved figure.</span>
<span class="sd">        ax : matplotlib.Axis (default None)</span>
<span class="sd">            Axis on which to plot the choropleth.</span>
<span class="sd">            Default is ``None``, which plots on the current figure.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        f, ax : tuple</span>
<span class="sd">            Matplotlib figure and axis on which the plot is made.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import libpysal</span>
<span class="sd">        &gt;&gt;&gt; import geopandas</span>
<span class="sd">        &gt;&gt;&gt; import mapclassify</span>
<span class="sd">        &gt;&gt;&gt; gdf = geopandas.read_file(libpysal.examples.get_path(&quot;columbus.shp&quot;))</span>
<span class="sd">        &gt;&gt;&gt; q5 = mapclassify.Quantiles(gdf.CRIME)</span>
<span class="sd">        &gt;&gt;&gt; q5.plot(gdf)  # doctest: +SKIP</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Requires ``matplotlib``, and implicitly requires a</span>
<span class="sd">        ``geopandas.GeoDataFrame`` as input.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;Mapclassify.plot depends on matplotlib.pyplot, and this was&quot;</span>
                <span class="s2">&quot;not able to be imported. </span><span class="se">\n</span><span class="s2">Install matplotlib to&quot;</span>
                <span class="s2">&quot;plot spatial classifier.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">_cl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;_cl&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">border_color</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">border_width</span><span class="p">,</span>
            <span class="n">scheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
            <span class="n">legend_kwds</span><span class="o">=</span><span class="n">legend_kwds</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axis_on</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot_histogram</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">despine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot histogram of `y` with bin values superimposed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color : str, optional</span>
<span class="sd">            hue to color bars of the histogram, by default &quot;dodgerblue&quot;.</span>
<span class="sd">        linecolor : str, optional</span>
<span class="sd">            color of the lines demarcating each class bin, by default &quot;black&quot;</span>
<span class="sd">        linewidth : int, optional</span>
<span class="sd">            change the linewidth demarcating each class bin</span>
<span class="sd">        ax : matplotlib.Axes, optional</span>
<span class="sd">            axes object to plot onto, by default None</span>
<span class="sd">        despine : bool, optional</span>
<span class="sd">            If True, to use seaborn&#39;s despine function to remove top and right axes,</span>
<span class="sd">            default is True</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            additional keyword arguments passed to matplotlib.axes.Axes.hist, by default</span>
<span class="sd">            None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.Axes</span>
<span class="sd">            an Axes object with histogram and class bins</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ImportError</span>
<span class="sd">            depends matplotlib and rasies if not installed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span><span class="p">(</span>
                <span class="s2">&quot;You must have matplotlib available to use this function&quot;</span>
            <span class="p">)</span>
        <span class="c1"># plot `y` as a histogram</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># get the top of the ax so we know how high to raise each class bar</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># plot upper limit of each bin</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="c1"># despine if specified</span>
        <span class="k">if</span> <span class="n">despine</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot_legendgram</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">inset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">clip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vlines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">vlinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">vlinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span>
        <span class="n">legend_size</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;27%&quot;</span><span class="p">,</span> <span class="s2">&quot;20%&quot;</span><span class="p">),</span>
        <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">tick_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot a legendgram, which is a histogram with classification breaks.</span>

<span class="sd">        Legendgrams are map legends that visualize the distribution of observations</span>
<span class="sd">        by color in a given map.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib.Axes, optional</span>
<span class="sd">            Matplotlib axes on which to draw the plot, by default None</span>
<span class="sd">        cmap : str | matplotlib.colors.Colormap, optional</span>
<span class="sd">            Matplotlib colormap for the histogram, by default ``None``.</span>
<span class="sd">            If ``None``, defaults to the most recent colormap associated with</span>
<span class="sd">            the input ``ax``. If there is no colormap associated with ``ax`` then</span>
<span class="sd">            ``&#39;viridis&#39;`` is used.</span>
<span class="sd">        bins : int, optional</span>
<span class="sd">            Number of bins for histogram, by default 50</span>
<span class="sd">        inset : bool, optional</span>
<span class="sd">            Whether to plot the legendgram as an inset axis (True) or directly on</span>
<span class="sd">            provided ax (False), by default True</span>
<span class="sd">        clip : tuple, optional</span>
<span class="sd">            Min and max values to clip the histogram x axis, by default None</span>
<span class="sd">        vlines : bool, optional</span>
<span class="sd">            Whether to draw vertical lines for class breaks, by default False</span>
<span class="sd">        vlinecolor : str, optional</span>
<span class="sd">            Color for vertical lines showing breaks, by default &quot;black&quot;</span>
<span class="sd">        vlinewidth : int, optional</span>
<span class="sd">            Width of vertical lines showing breaks, by default 1</span>
<span class="sd">        loc : str, optional</span>
<span class="sd">            Location for the inset axes if inset=True, by default &quot;lower left&quot;</span>
<span class="sd">        legend_size : tuple, optional</span>
<span class="sd">            tuple of floats or strings describing the (width, height) of the legend. If</span>
<span class="sd">            a float is provided, it is the size in inches, e.g. ``(1.3, 1)``. If a</span>
<span class="sd">            string is provided, it is the size in relative units, e.g.</span>
<span class="sd">            ``(&#39;40%&#39;, &#39;20%&#39;)``. By default, i.e. if ``bbox_to_anchor`` is not specified,</span>
<span class="sd">            those are relative to the `ax`. Otherwise, they are to be understood</span>
<span class="sd">            relative to the bounding box provided via ``bbox_to_anchor``. By default</span>
<span class="sd">            (&quot;27%&quot;, &quot;20%&quot;)</span>
<span class="sd">        frameon : bool, optional</span>
<span class="sd">            Whether to draw a frame around the inset legend, by default False</span>
<span class="sd">        tick_params : dict, optional</span>
<span class="sd">            Dictionary of parameters to customize tick appearance, by default None</span>
<span class="sd">        bbox_to_anchor : tuple or ``matplotlib.trasforms.BboxBase``</span>
<span class="sd">            Bbox that the inset axes will be anchored to. If None, a tuple of</span>
<span class="sd">            ``(0, 0, 1, 1)`` is used. If a tuple, can be either</span>
<span class="sd">            ``[left, bottom, width, height]``, or ``[left, bottom]``. If the</span>
<span class="sd">            ``legend_size`` is in relative units (%), the 2-tuple ``[left, bottom]``</span>
<span class="sd">            cannot be used. By default None</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional keyword arguments passed to ``Axes.hist``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.Axes</span>
<span class="sd">            The axes object containing the legendgram plot</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import mapclassify</span>
<span class="sd">        &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">        &gt;&gt;&gt; from libpysal import examples</span>

<span class="sd">        Load example data:</span>

<span class="sd">        &gt;&gt;&gt; data = gpd.read_file(examples.get_path(&#39;south.shp&#39;)).to_crs(epsg=5070)</span>

<span class="sd">        Plot the map with the legendgram included.</span>

<span class="sd">        &gt;&gt;&gt; ax = data.plot(&#39;DV80&#39;, k=10, scheme=&#39;Quantiles&#39;)</span>
<span class="sd">        &gt;&gt;&gt; classifier = mapclassify.Quantiles(data[&#39;DV80&#39;].values, k=10)</span>
<span class="sd">        &gt;&gt;&gt; lg_ax = classifier.plot_legendgram(</span>
<span class="sd">        ...     ax=ax,</span>
<span class="sd">        ...     legend_size=(&quot;50%&quot;, &quot;20%&quot;), # legend size in percentage of the axis</span>
<span class="sd">        ...     loc=&#39;upper left&#39;,  # matplotlib-style legend locations</span>
<span class="sd">        ...     clip=(2, 10),  # clip the displayed range of the histogram</span>
<span class="sd">        ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_legendgram</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
            <span class="n">inset</span><span class="o">=</span><span class="n">inset</span><span class="p">,</span>
            <span class="n">clip</span><span class="o">=</span><span class="n">clip</span><span class="p">,</span>
            <span class="n">vlines</span><span class="o">=</span><span class="n">vlines</span><span class="p">,</span>
            <span class="n">vlinecolor</span><span class="o">=</span><span class="n">vlinecolor</span><span class="p">,</span>
            <span class="n">vlinewidth</span><span class="o">=</span><span class="n">vlinewidth</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
            <span class="n">legend_size</span><span class="o">=</span><span class="n">legend_size</span><span class="p">,</span>
            <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
            <span class="n">tick_params</span><span class="o">=</span><span class="n">tick_params</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>


<div class="viewcode-block" id="HeadTailBreaks">
<a class="viewcode-back" href="../../generated/mapclassify.HeadTailBreaks.html#mapclassify.HeadTailBreaks">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HeadTailBreaks</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Head/tail Breaks Map Classification for Heavy-tailed Distributions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; numpy.random.seed(10)</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; htb = mapclassify.HeadTailBreaks(cal)</span>
<span class="sd">    &gt;&gt;&gt; htb.k</span>
<span class="sd">    3</span>

<span class="sd">    &gt;&gt;&gt; htb.counts.tolist()</span>
<span class="sd">    [50, 7, 1]</span>

<span class="sd">    &gt;&gt;&gt; htb.bins</span>
<span class="sd">    array([ 125.92810345,  811.26      , 4111.45      ])</span>

<span class="sd">    &gt;&gt;&gt; numpy.random.seed(123456)</span>
<span class="sd">    &gt;&gt;&gt; x = numpy.random.lognormal(3, 1, 1000)</span>
<span class="sd">    &gt;&gt;&gt; htb = mapclassify.HeadTailBreaks(x)</span>
<span class="sd">    &gt;&gt;&gt; htb.bins</span>
<span class="sd">    array([ 32.26204423,  72.50205622, 128.07150107, 190.2899093 ,</span>
<span class="sd">           264.82847377, 457.88157946, 576.76046949])</span>

<span class="sd">    &gt;&gt;&gt; htb.counts.tolist()</span>
<span class="sd">    [695, 209, 62, 22, 10, 1, 1]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Head/tail Breaks is a relatively new classification method developed</span>
<span class="sd">    for data with a heavy-tailed distribution.</span>

<span class="sd">    Implementation based on contributions by</span>
<span class="sd">    Alessandra Sozzi &lt;alessandra.sozzi@gmail.com&gt;.</span>

<span class="sd">    For theoretical details see :cite:`Jiang_2013`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HeadTailBreaks.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.HeadTailBreaks.html#mapclassify.HeadTailBreaks.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;HeadTailBreaks&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">head_tail_breaks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span></div>



<div class="viewcode-block" id="EqualInterval">
<a class="viewcode-back" href="../../generated/mapclassify.EqualInterval.html#mapclassify.EqualInterval">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EqualInterval</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Equal Interval Classification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations. Each value is the ID of the class</span>
<span class="sd">        the observation belongs to</span>
<span class="sd">        :math:`yb[i] = j` for :math:`j&gt;=1` if :math:`bins[j-1] &lt; y[i] &lt;= bins[j]`,</span>
<span class="sd">        otherwise :math:`yb[i] = 0`.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; ei = mapclassify.EqualInterval(cal, k=5)</span>
<span class="sd">    &gt;&gt;&gt; ei.k</span>
<span class="sd">    5</span>

<span class="sd">    &gt;&gt;&gt; ei.counts.tolist()</span>
<span class="sd">    [57, 0, 0, 0, 1]</span>

<span class="sd">    &gt;&gt;&gt; ei.bins</span>
<span class="sd">    array([ 822.394, 1644.658, 2466.922, 3289.186, 4111.45 ])</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Intervals defined to have equal width:</span>

<span class="sd">    .. math::</span>

<span class="sd">        bins_j = min(y)+w*(j+1)</span>

<span class="sd">    with :math:`w=\\frac{max(y)-min(j)}{k}`</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="EqualInterval.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.EqualInterval.html#mapclassify.EqualInterval.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        see class docstring</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not enough unique values in array to form </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> classes. &quot;</span>
                <span class="s2">&quot;All values in `y` are equal.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;EqualInterval&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">rg</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">rg</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">k</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_y</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cuts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">:</span>  <span class="c1"># handle overshooting</span>
            <span class="n">cuts</span> <span class="o">=</span> <span class="n">cuts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">k</span><span class="p">]</span>
        <span class="n">cuts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_y</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">cuts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span></div>



<div class="viewcode-block" id="Percentiles">
<a class="viewcode-back" href="../../generated/mapclassify.Percentiles.html#mapclassify.Percentiles">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Percentiles</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percentiles Map Classification</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        Attribute to classify.</span>
<span class="sd">    pct : numpy.array (default [1, 10, 50, 90, 99, 100])</span>
<span class="sd">        Percentiles.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; p = mapclassify.Percentiles(cal)</span>
<span class="sd">    &gt;&gt;&gt; p.bins</span>
<span class="sd">    array([1.357000e-01, 5.530000e-01, 9.365000e+00, 2.139140e+02,</span>
<span class="sd">           2.179948e+03, 4.111450e+03])</span>

<span class="sd">    &gt;&gt;&gt; p.counts.tolist()</span>
<span class="sd">    [1, 5, 23, 23, 5, 1]</span>

<span class="sd">    &gt;&gt;&gt; p2 = mapclassify.Percentiles(cal, pct = [50, 100])</span>
<span class="sd">    &gt;&gt;&gt; p2.bins</span>
<span class="sd">    array([   9.365, 4111.45 ])</span>

<span class="sd">    &gt;&gt;&gt; p2.counts.tolist()</span>
<span class="sd">    [29, 29]</span>
<span class="sd">    &gt;&gt;&gt; p2.k</span>
<span class="sd">    2</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Percentiles.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.Percentiles.html#mapclassify.Percentiles.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">100</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pct</span> <span class="o">=</span> <span class="n">pct</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Percentiles&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">pct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pct</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>

<div class="viewcode-block" id="Percentiles.update">
<a class="viewcode-back" href="../../generated/mapclassify.Percentiles.html#mapclassify.Percentiles.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">         y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;pct&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pct&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pct</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>
</div>



<div class="viewcode-block" id="PrettyBreaks">
<a class="viewcode-back" href="../../generated/mapclassify.PrettyBreaks.html#mapclassify.PrettyBreaks">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PrettyBreaks</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<div class="viewcode-block" id="PrettyBreaks.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.PrettyBreaks.html#mapclassify.PrettyBreaks.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pretty breakpoints</span>

<span class="sd">        Computes breaks that are equally spaced round values which</span>
<span class="sd">        cover the range of values in `y`. The breaks are chosen so that</span>
<span class="sd">        they are 1, 2, or 5 times a power of 10.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y : array (n,1)</span>
<span class="sd">            attribute to classify</span>
<span class="sd">        k : int</span>
<span class="sd">            The number of desired classes</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The number of classes may be different from the specified `k`,</span>
<span class="sd">        as the rounding of the upper bounds takes precedent.</span>

<span class="sd">        The lower bound of the first interval will be equal to the</span>
<span class="sd">        minimum of the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Pretty&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">_pretty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>



<div class="viewcode-block" id="BoxPlot">
<a class="viewcode-back" href="../../generated/mapclassify.BoxPlot.html#mapclassify.BoxPlot">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BoxPlot</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BoxPlot Map Classification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        Attribute to classify</span>
<span class="sd">    hinge : float (default 1.5)</span>
<span class="sd">        Multiplier for *IQR*.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin ids for observations.</span>
<span class="sd">    bins : array</span>
<span class="sd">        :math:`(n,1)`, the upper bounds of each class  (monotonic).</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>
<span class="sd">    low_outlier_ids : numpy.array</span>
<span class="sd">        Indices of observations that are low outliers.</span>
<span class="sd">    high_outlier_ids : numpy.array</span>
<span class="sd">        Indices of observations that are high outliers.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The bins are set as follows::</span>

<span class="sd">        bins[0] = q[0]-hinge*IQR</span>
<span class="sd">        bins[1] = q[0]</span>
<span class="sd">        bins[2] = q[1]</span>
<span class="sd">        bins[3] = q[2]</span>
<span class="sd">        bins[4] = q[2]+hinge*IQR</span>
<span class="sd">        bins[5] = inf  (see Notes)</span>

<span class="sd">    where :math:`q` is an array of the first three quartiles of :math:`y` and</span>
<span class="sd">    :math:`IQR=q[2]-q[0]`.</span>

<span class="sd">    If :math:`q[2]+hinge*IQR &gt; max(y)` there will only be 5 classes and no high</span>
<span class="sd">    outliers, otherwise, there will be 6 classes and at least one high</span>
<span class="sd">    outlier.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; bp = mapclassify.BoxPlot(cal)</span>
<span class="sd">    &gt;&gt;&gt; bp.bins</span>
<span class="sd">    array([-5.287625e+01,  2.567500e+00,  9.365000e+00,  3.953000e+01,</span>
<span class="sd">            9.497375e+01,  4.111450e+03])</span>

<span class="sd">    &gt;&gt;&gt; bp.counts.tolist()</span>
<span class="sd">    [0, 15, 14, 14, 6, 9]</span>

<span class="sd">    &gt;&gt;&gt; bp.high_outlier_ids.tolist()</span>
<span class="sd">    [0, 6, 18, 29, 33, 36, 37, 40, 42]</span>

<span class="sd">    &gt;&gt;&gt; cal[bp.high_outlier_ids].values</span>
<span class="sd">    array([ 329.92,  181.27,  370.5 ,  722.85,  192.05,  110.74, 4111.45,</span>
<span class="sd">            317.11,  264.93])</span>

<span class="sd">    &gt;&gt;&gt; bx = mapclassify.BoxPlot(numpy.arange(100))</span>
<span class="sd">    &gt;&gt;&gt; bx.bins</span>
<span class="sd">    array([-49.5 ,  24.75,  49.5 ,  74.25, 148.5 ])</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BoxPlot.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.BoxPlot.html#mapclassify.BoxPlot.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hinge</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        y : numpy.array</span>
<span class="sd">            :math:`(n,1)`, attribute to classify</span>
<span class="sd">        hinge : float (default 1.5)</span>
<span class="sd">            Multiple of inter-quartile range.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hinge</span> <span class="o">=</span> <span class="n">hinge</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;BoxPlot&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">pct</span> <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pct</span><span class="p">]</span>
        <span class="n">iqr</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iqr</span> <span class="o">=</span> <span class="n">iqr</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hinge</span> <span class="o">*</span> <span class="n">iqr</span>
        <span class="n">left_fence</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pivot</span>
        <span class="n">right_fence</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">pivot</span>
        <span class="k">if</span> <span class="n">right_fence</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">bins</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">right_fence</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_fence</span>
        <span class="n">bins</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">left_fence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_classify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="n">_classify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_outlier_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yb</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">high_outlier_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yb</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="BoxPlot.update">
<a class="viewcode-back" href="../../generated/mapclassify.BoxPlot.html#mapclassify.BoxPlot.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;hinge&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hinge&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hinge</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>
</div>



<div class="viewcode-block" id="Quantiles">
<a class="viewcode-back" href="../../generated/mapclassify.Quantiles.html#mapclassify.Quantiles">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Quantiles</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quantile Map Classification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations. Each value is the ID of the class</span>
<span class="sd">        the observation belongs to</span>
<span class="sd">        :math:`yb[i] = j` for :math:`j&gt;=1` if :math:`bins[j-1] &lt; y[i] &lt;= bins[j]`,</span>
<span class="sd">        otherwise :math:`yb[i] = 0`.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; q = mapclassify.Quantiles(cal, k=5)</span>
<span class="sd">    &gt;&gt;&gt; q.bins</span>
<span class="sd">    array([1.46400e+00, 5.79800e+00, 1.32780e+01, 5.46160e+01, 4.11145e+03])</span>

<span class="sd">    &gt;&gt;&gt; q.counts.tolist()</span>
<span class="sd">    [12, 11, 12, 11, 12]</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Quantiles.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.Quantiles.html#mapclassify.Quantiles.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Quantiles&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">quantile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="StdMean">
<a class="viewcode-back" href="../../generated/mapclassify.StdMean.html#mapclassify.StdMean">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StdMean</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Standard Deviation and Mean Map Classification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify</span>
<span class="sd">    multiples : numpy.array (default [-2, -1, 1, 2])</span>
<span class="sd">        The multiples of the standard deviation to add/subtract from</span>
<span class="sd">        the sample mean to define the bins.</span>
<span class="sd">    anchor : bool (default False)</span>
<span class="sd">        Anchor upper bound of one class to the sample mean.</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    If anchor is True, one of the intervals will have its closed upper bound</span>
<span class="sd">    equal to the mean of y. Intermediate intervals will have widths equal to</span>
<span class="sd">    the standard deviation of y. The first interval will be closed on the</span>
<span class="sd">    minimum value of y, and the last interval will be closed on the maximum of</span>
<span class="sd">    y. The first and last intervals may have widths different from the</span>
<span class="sd">    intermediate intervals.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; st = mapclassify.StdMean(cal)</span>
<span class="sd">    &gt;&gt;&gt; st.k</span>
<span class="sd">    5</span>

<span class="sd">    &gt;&gt;&gt; st.bins</span>
<span class="sd">    array([-967.36235382, -420.71712519,  672.57333208, 1219.21856072,</span>
<span class="sd">           4111.45      ])</span>

<span class="sd">    &gt;&gt;&gt; st.counts.tolist()</span>
<span class="sd">    [0, 0, 56, 1, 1]</span>

<span class="sd">    &gt;&gt;&gt; st3 = mapclassify.StdMean(cal, multiples = [-3, -1.5, 1.5, 3])</span>
<span class="sd">    &gt;&gt;&gt; st3.bins</span>
<span class="sd">    array([-1514.00758246,  -694.03973951,   945.8959464 ,  1765.86378936,</span>
<span class="sd">            4111.45      ])</span>

<span class="sd">    &gt;&gt;&gt; st3.counts.tolist()</span>
<span class="sd">    [0, 0, 57, 0, 1]</span>
<span class="sd">    &gt;&gt;&gt; stda = mapclassify.StdMean(cal, anchor=True)</span>
<span class="sd">    &gt;&gt;&gt; stda.k</span>
<span class="sd">    9</span>
<span class="sd">    &gt;&gt;&gt; stda.bins</span>
<span class="sd">    array([ 125.92810345,  672.57333208, 1219.21856072, 1765.86378936,</span>
<span class="sd">           2312.50901799, 2859.15424663, 3405.79947527, 3952.4447039 ,</span>
<span class="sd">           4111.45      ])</span>
<span class="sd">    &gt;&gt;&gt; float(cal.mean()), float(cal.std()), float(cal.min()), float(cal.max())</span>
<span class="sd">    (125.92810344827588, 546.6452286365233, 0.13, 4111.45)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="StdMean.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.StdMean.html#mapclassify.StdMean.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">multiples</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiples</span> <span class="o">=</span> <span class="n">multiples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">anchor</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;StdMean&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span><span class="p">:</span>
            <span class="n">min_z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">max_z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">min_z</span><span class="p">,</span> <span class="n">max_z</span><span class="p">))</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiples</span><span class="p">]</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cuts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">:</span>
            <span class="n">cuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cuts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cuts</span><span class="p">)</span>

<div class="viewcode-block" id="StdMean.update">
<a class="viewcode-back" href="../../generated/mapclassify.StdMean.html#mapclassify.StdMean.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">         y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;multiples&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;multiples&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiples</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>
</div>



<div class="viewcode-block" id="MaximumBreaks">
<a class="viewcode-back" href="../../generated/mapclassify.MaximumBreaks.html#mapclassify.MaximumBreaks">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MaximumBreaks</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maximum Breaks Map Classification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>

<span class="sd">    mindiff : float (default 0)</span>
<span class="sd">        The minimum difference between class breaks.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; mb = mapclassify.MaximumBreaks(cal, k=5)</span>
<span class="sd">    &gt;&gt;&gt; mb.k</span>
<span class="sd">    5</span>

<span class="sd">    &gt;&gt;&gt; mb.bins</span>
<span class="sd">    array([ 146.005,  228.49 ,  546.675, 2417.15 , 4111.45 ])</span>

<span class="sd">    &gt;&gt;&gt; mb.counts.tolist()</span>
<span class="sd">    [50, 2, 4, 1, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MaximumBreaks.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.MaximumBreaks.html#mapclassify.MaximumBreaks.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mindiff</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not enough unique values in array to form </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> classes. &quot;</span>
                <span class="s2">&quot;All values in `y` are equal.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mindiff</span> <span class="o">=</span> <span class="n">mindiff</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MaximumBreaks&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">xs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">ud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ud</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">k1</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Insufficient number of unique diffs. Breaks are random.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">xs</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>

<div class="viewcode-block" id="MaximumBreaks.update">
<a class="viewcode-back" href="../../generated/mapclassify.MaximumBreaks.html#mapclassify.MaximumBreaks.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">         y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)})</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;mindiff&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;mindiff&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mindiff</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>
</div>



<div class="viewcode-block" id="NaturalBreaks">
<a class="viewcode-back" href="../../generated/mapclassify.NaturalBreaks.html#mapclassify.NaturalBreaks">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NaturalBreaks</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Natural Breaks Map Classification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>
<span class="sd">    initial : int (default 10)</span>
<span class="sd">        The number of initial solutions generated with different centroids.</span>
<span class="sd">        The best of initial results are returned.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; numpy.random.seed(123456)</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; nb = mapclassify.NaturalBreaks(cal, k=5)</span>
<span class="sd">    &gt;&gt;&gt; nb.k</span>
<span class="sd">    5</span>

<span class="sd">    &gt;&gt;&gt; nb.counts.tolist()</span>
<span class="sd">    [49, 3, 4, 1, 1]</span>

<span class="sd">    &gt;&gt;&gt; nb.bins</span>
<span class="sd">    array([  75.29,  192.05,  370.5 ,  722.85, 4111.45])</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="NaturalBreaks.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.NaturalBreaks.html#mapclassify.NaturalBreaks.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">initial</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NaturalBreaks&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">uv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">uvk</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uvk</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not enough unique values in array to form </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> classes. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Setting k to </span><span class="si">{</span><span class="n">uvk</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">uvk</span>
            <span class="n">uv</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="c1"># we set the bins equal to the sorted unique values and ramp k</span>
            <span class="c1"># downwards. no need to call kmeans.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">uv</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res0</span> <span class="o">=</span> <span class="n">natural_breaks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>

<div class="viewcode-block" id="NaturalBreaks.update">
<a class="viewcode-back" href="../../generated/mapclassify.NaturalBreaks.html#mapclassify.NaturalBreaks.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>
</div>



<div class="viewcode-block" id="FisherJenks">
<a class="viewcode-back" href="../../generated/mapclassify.FisherJenks.html#mapclassify.FisherJenks">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FisherJenks</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fisher Jenks optimal classifier - mean based.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; fj = mapclassify.FisherJenks(cal)</span>
<span class="sd">    &gt;&gt;&gt; float(fj.adcm)</span>
<span class="sd">    799.24</span>

<span class="sd">    &gt;&gt;&gt; fj.bins.tolist()</span>
<span class="sd">    [75.29, 192.05, 370.5, 722.85, 4111.45]</span>

<span class="sd">    &gt;&gt;&gt; fj.counts.tolist()</span>
<span class="sd">    [49, 3, 4, 1, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FisherJenks.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.FisherJenks.html#mapclassify.FisherJenks.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_NUMBA</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Numba not installed. Using slow pure python version.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">nu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nu</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fewer unique values (</span><span class="si">{</span><span class="n">nu</span><span class="si">}</span><span class="s2">) than specified classes (</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;FisherJenks&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">_fisher_jenks_means</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="FisherJenksSampled">
<a class="viewcode-back" href="../../generated/mapclassify.FisherJenksSampled.html#mapclassify.FisherJenksSampled">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FisherJenksSampled</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fisher Jenks optimal classifier - mean based using random sample.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>
<span class="sd">    pct : float (default 0.10)</span>
<span class="sd">        The percentage of :math:`n` that should form the sample.</span>
<span class="sd">        If ``pct`` is specified such that :math:`n*pct &gt; 1000`, then</span>
<span class="sd">        :math:`pct = 1000./n`, unless truncate is ``False``.</span>
<span class="sd">    truncate : bool (default True)</span>
<span class="sd">        Truncate ``pct`` in cases where :math:`pct * n &gt; 1000.`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    For theoretical details see :cite:`Rey_2016`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FisherJenksSampled.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.FisherJenksSampled.html#mapclassify.FisherJenksSampled.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">pct</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pct</span> <span class="o">*</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="ow">and</span> <span class="n">truncate</span><span class="p">:</span>
            <span class="n">pct</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">pct</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">yr</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">ids</span><span class="p">]</span>
        <span class="n">yr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># make sure we have the upper bound</span>
        <span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># make sure we have the min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pct</span> <span class="o">=</span> <span class="n">pct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_truncated</span> <span class="o">=</span> <span class="n">truncate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yr</span> <span class="o">=</span> <span class="n">yr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yr_n</span> <span class="o">=</span> <span class="n">yr</span><span class="o">.</span><span class="n">size</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">bin1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;FisherJenksSampled&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="p">()</span>  <span class="c1"># have to recalculate summary stats</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fj</span> <span class="o">=</span> <span class="n">FisherJenks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">fj</span><span class="o">.</span><span class="n">bins</span>

<div class="viewcode-block" id="FisherJenksSampled.update">
<a class="viewcode-back" href="../../generated/mapclassify.FisherJenksSampled.html#mapclassify.FisherJenksSampled.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">         y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)})</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;pct&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pct&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pct</span><span class="p">)})</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;truncate&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncated</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>
</div>



<div class="viewcode-block" id="JenksCaspall">
<a class="viewcode-back" href="../../generated/mapclassify.JenksCaspall.html#mapclassify.JenksCaspall">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">JenksCaspall</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Jenks Caspall Map Classification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; jc = mapclassify.JenksCaspall(cal, k=5)</span>
<span class="sd">    &gt;&gt;&gt; jc.bins</span>
<span class="sd">    array([1.81000e+00, 7.60000e+00, 2.98200e+01, 1.81270e+02, 4.11145e+03])</span>

<span class="sd">    &gt;&gt;&gt; jc.counts.tolist()</span>
<span class="sd">    [14, 13, 14, 10, 7]</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="JenksCaspall.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.JenksCaspall.html#mapclassify.JenksCaspall.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;JenksCaspall&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="c1"># start with quantiles</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">solving</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">xb</span><span class="p">,</span> <span class="n">cnts</span> <span class="o">=</span> <span class="n">bin1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="c1"># class means</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">xm</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">xb</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">xb</span><span class="p">)]</span>
        <span class="n">xb0</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">xm</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">rk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">solving</span><span class="p">:</span>
            <span class="n">xb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xb0</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">xb</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xb0</span> <span class="o">==</span> <span class="n">xb</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">solving</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xb0</span> <span class="o">=</span> <span class="n">xb</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">xb</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rk</span><span class="p">])</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">xb</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">xb</span><span class="p">)])</span>
        <span class="n">cuts</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cuts</span><span class="p">),)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">cuts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">it</span></div>



<div class="viewcode-block" id="JenksCaspallSampled">
<a class="viewcode-back" href="../../generated/mapclassify.JenksCaspallSampled.html#mapclassify.JenksCaspallSampled">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">JenksCaspallSampled</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Jenks Caspall Map Classification using a random sample.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>
<span class="sd">    pct : float (default 0.10)</span>
<span class="sd">        The percentage of :math:`n` that should form the sample.</span>
<span class="sd">        If ``pct`` is specified such that :math:`n*pct &gt; 1000`, then</span>
<span class="sd">        :math:`pct = 1000./n`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; numpy.random.seed(0)</span>
<span class="sd">    &gt;&gt;&gt; x = numpy.random.random(100000)</span>
<span class="sd">    &gt;&gt;&gt; jc = mapclassify.JenksCaspall(x)</span>
<span class="sd">    &gt;&gt;&gt; jcs = mapclassify.JenksCaspallSampled(x)</span>
<span class="sd">    &gt;&gt;&gt; jc.bins</span>
<span class="sd">    array([0.20108144, 0.4025151 , 0.60396127, 0.80302249, 0.99997795])</span>

<span class="sd">    &gt;&gt;&gt; jcs.bins</span>
<span class="sd">    array([0.19978245, 0.40793025, 0.59253555, 0.78241472, 0.99997795])</span>

<span class="sd">    &gt;&gt;&gt; jc.counts.tolist()</span>
<span class="sd">    [20286, 19951, 20310, 19708, 19745]</span>

<span class="sd">    &gt;&gt;&gt; jcs.counts.tolist()</span>
<span class="sd">    [20147, 20633, 18591, 18857, 21772]</span>

<span class="sd">    # not for testing since we get different times on different hardware</span>
<span class="sd">    # just included for documentation of likely speed gains</span>
<span class="sd">    #&gt;&gt;&gt; t1 = time.time(); jc = Jenks_Caspall(x); t2 = time.time()</span>
<span class="sd">    #&gt;&gt;&gt; t1s = time.time(); jcs = Jenks_Caspall_Sampled(x); t2s = time.time()</span>
<span class="sd">    #&gt;&gt;&gt; t2 - t1; t2s - t1s</span>
<span class="sd">    #1.8292930126190186</span>
<span class="sd">    #0.061631917953491211</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This is intended for large :math:`n` problems. The logic is to apply</span>
<span class="sd">    ``Jenks_Caspall`` to a random subset of the :math:`y` space and then bin the</span>
<span class="sd">    complete vector :math:`y` on the bins obtained from the subset. This would</span>
<span class="sd">    trade off some &quot;accuracy&quot; for a gain in speed.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="JenksCaspallSampled.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.JenksCaspallSampled.html#mapclassify.JenksCaspallSampled.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">pct</span><span class="o">=</span><span class="mf">0.10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">pct</span> <span class="o">*</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">pct</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">pct</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">yr</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">ids</span><span class="p">]</span>
        <span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># make sure we have the upper bound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pct</span> <span class="o">=</span> <span class="n">pct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yr</span> <span class="o">=</span> <span class="n">yr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yr_n</span> <span class="o">=</span> <span class="n">yr</span><span class="o">.</span><span class="n">size</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">bin1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;JenksCaspallSampled&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="p">()</span>  <span class="c1"># have to recalculate summary stats</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">jc</span> <span class="o">=</span> <span class="n">JenksCaspall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">jc</span><span class="o">.</span><span class="n">bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">jc</span><span class="o">.</span><span class="n">iterations</span>

<div class="viewcode-block" id="JenksCaspallSampled.update">
<a class="viewcode-back" href="../../generated/mapclassify.JenksCaspallSampled.html#mapclassify.JenksCaspallSampled.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">         y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)})</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;pct&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pct&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pct</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>
</div>



<div class="viewcode-block" id="JenksCaspallForced">
<a class="viewcode-back" href="../../generated/mapclassify.JenksCaspallForced.html#mapclassify.JenksCaspallForced">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">JenksCaspallForced</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Jenks Caspall  Map Classification with forced movements.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default 5)</span>
<span class="sd">        The number of classes required.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; jcf = mapclassify.JenksCaspallForced(cal, k=5)</span>
<span class="sd">    &gt;&gt;&gt; jcf.k</span>
<span class="sd">    5</span>

<span class="sd">    &gt;&gt;&gt; jcf.bins</span>
<span class="sd">    array([1.34000e+00, 5.90000e+00, 1.67000e+01, 5.06500e+01, 4.11145e+03])</span>

<span class="sd">    &gt;&gt;&gt; jcf.counts.tolist()</span>
<span class="sd">    [12, 12, 13, 9, 12]</span>

<span class="sd">    &gt;&gt;&gt; jcf4 = mapclassify.JenksCaspallForced(cal, k=4)</span>
<span class="sd">    &gt;&gt;&gt; jcf4.k</span>
<span class="sd">    4</span>

<span class="sd">    &gt;&gt;&gt; jcf4.bins</span>
<span class="sd">    array([2.51000e+00, 8.70000e+00, 3.66800e+01, 4.11145e+03])</span>

<span class="sd">    &gt;&gt;&gt; jcf4.counts.tolist()</span>
<span class="sd">    [15, 14, 14, 15]</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="JenksCaspallForced.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.JenksCaspallForced.html#mapclassify.JenksCaspallForced.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not enough unique values in array to form </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> classes. &quot;</span>
                <span class="s2">&quot;All values in `y` are equal.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;JenksCaspallForced&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">solving</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">xb</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">bin1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="c1"># class means</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">xm</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">xb</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">xb</span><span class="p">)]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">xm</span>
        <span class="n">xbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xm</span><span class="p">[</span><span class="n">xbi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xbi</span> <span class="ow">in</span> <span class="n">xb</span><span class="p">])</span>
        <span class="n">xbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">xbar</span>
        <span class="n">ss</span> <span class="o">*=</span> <span class="n">ss</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
        <span class="n">down_moves</span> <span class="o">=</span> <span class="n">up_moves</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">solving</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">solving</span><span class="p">:</span>
            <span class="c1"># try upward moves first</span>
            <span class="n">moving_up</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">while</span> <span class="n">moving_up</span><span class="p">:</span>
                <span class="n">class_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
                <span class="n">nk</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">xb</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">class_ids</span><span class="p">]</span>
                <span class="n">candidates</span> <span class="o">=</span> <span class="n">nk</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">up_moves</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">candidates</span><span class="p">:</span>
                    <span class="n">nki</span> <span class="o">=</span> <span class="n">candidates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nki</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">xb</span> <span class="o">==</span> <span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">mover</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">tmp</span><span class="p">[</span><span class="n">mover</span><span class="p">]</span> <span class="o">=</span> <span class="n">xb</span><span class="p">[</span><span class="n">mover</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">tm</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">tmp</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span>
                        <span class="n">txbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tm</span><span class="p">[</span><span class="n">xbi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xbi</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">])</span>
                        <span class="n">txbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">tss</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">txbar</span>
                        <span class="n">tss</span> <span class="o">*=</span> <span class="n">tss</span>
                        <span class="n">tss</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tss</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tss</span> <span class="o">&lt;</span> <span class="n">ss</span><span class="p">:</span>
                            <span class="n">xb</span> <span class="o">=</span> <span class="n">tmp</span>
                            <span class="n">ss</span> <span class="o">=</span> <span class="n">tss</span>
                            <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">up_moves</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">up_moves</span><span class="p">:</span>
                    <span class="n">moving_up</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">moving_down</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">while</span> <span class="n">moving_down</span><span class="p">:</span>
                <span class="n">class_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
                <span class="n">nk</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">xb</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">class_ids</span><span class="p">]</span>
                <span class="n">candidates</span> <span class="o">=</span> <span class="n">nk</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">down_moves</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">candidates</span><span class="p">:</span>
                    <span class="n">nki</span> <span class="o">=</span> <span class="n">candidates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nki</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">xb</span> <span class="o">==</span> <span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">mover</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">mover_class</span> <span class="o">=</span> <span class="n">xb</span><span class="p">[</span><span class="n">mover</span><span class="p">]</span>
                        <span class="n">target_class</span> <span class="o">=</span> <span class="n">mover_class</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">tmp</span><span class="p">[</span><span class="n">mover</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_class</span>
                        <span class="n">tm</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">tmp</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span>
                        <span class="n">txbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tm</span><span class="p">[</span><span class="n">xbi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xbi</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">])</span>
                        <span class="n">txbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">tss</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">txbar</span>
                        <span class="n">tss</span> <span class="o">*=</span> <span class="n">tss</span>
                        <span class="n">tss</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tss</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tss</span> <span class="o">&lt;</span> <span class="n">ss</span><span class="p">:</span>
                            <span class="n">xb</span> <span class="o">=</span> <span class="n">tmp</span>
                            <span class="n">ss</span> <span class="o">=</span> <span class="n">tss</span>
                            <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">down_moves</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">down_moves</span><span class="p">:</span>
                    <span class="n">moving_down</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">up_moves</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">down_moves</span><span class="p">:</span>
                <span class="n">solving</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">xb</span> <span class="o">==</span> <span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">xb</span><span class="p">)]</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cuts</span><span class="p">),</span> <span class="p">(</span><span class="n">k</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">cuts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">it</span></div>



<div class="viewcode-block" id="UserDefined">
<a class="viewcode-back" href="../../generated/mapclassify.UserDefined.html#mapclassify.UserDefined">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">UserDefined</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    User Specified Binning.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, upper bounds of classes (have to be monotically increasing).</span>
<span class="sd">    lowest : float (default None)</span>
<span class="sd">        Scalar minimum value of lowest class. Default is to set the minimum</span>
<span class="sd">        to ``-inf`` if  ``y.min()`` &gt; first upper bound (which will override</span>
<span class="sd">        the default), otherwise minimum is set to ``y.min()``.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; bins = [20, max(cal)]</span>
<span class="sd">    &gt;&gt;&gt; bins</span>
<span class="sd">    [20, 4111.45]</span>

<span class="sd">    &gt;&gt;&gt; ud = mapclassify.UserDefined(cal, bins)</span>
<span class="sd">    &gt;&gt;&gt; ud.bins.tolist()</span>
<span class="sd">    [20.0, 4111.45]</span>

<span class="sd">    &gt;&gt;&gt; ud.counts.tolist()</span>
<span class="sd">    [37, 21]</span>

<span class="sd">    &gt;&gt;&gt; bins = [20, 30]</span>
<span class="sd">    &gt;&gt;&gt; ud = mapclassify.UserDefined(cal, bins)</span>
<span class="sd">    &gt;&gt;&gt; ud.bins.tolist()</span>
<span class="sd">    [20.0, 30.0, 4111.45]</span>

<span class="sd">    &gt;&gt;&gt; ud.counts.tolist()</span>
<span class="sd">    [37, 4, 17]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    If upper bound of user bins does not exceed</span>
<span class="sd">    ``max(y)`` we append an additional bin.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="UserDefined.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.UserDefined.html#mapclassify.UserDefined.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">lowest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lowest</span> <span class="o">=</span> <span class="n">lowest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;UserDefined&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>

<div class="viewcode-block" id="UserDefined.update">
<a class="viewcode-back" href="../../generated/mapclassify.UserDefined.html#mapclassify.UserDefined.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data or change classification parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">         y : numpy.array (default None)</span>
<span class="sd">            :math:`(n,1)`, array of data to classify.</span>
<span class="sd">        inplace : bool (default False)</span>
<span class="sd">            Whether to conduct the update in place or to return a</span>
<span class="sd">            copy estimated from the additional specifications.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional parameters that are passed to the ``__init__`` function</span>
<span class="sd">            of the class. For documentation, check the class constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>


    <span class="c1"># We have to override the plot method for additional kwargs for UserDefined</span>
<div class="viewcode-block" id="UserDefined.plot">
<a class="viewcode-back" href="../../generated/mapclassify.UserDefined.html#mapclassify.UserDefined.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gdf</span><span class="p">,</span>
        <span class="n">border_color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>
        <span class="n">border_width</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGnBu&quot;</span><span class="p">,</span>
        <span class="n">axis_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="s2">&quot;fmt&quot;</span><span class="p">:</span> <span class="n">FMT</span><span class="p">},</span>
        <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;Mapclassify.plot depends on matplotlib.pyplot, and this was&quot;</span>
                <span class="s2">&quot;not able to be imported. </span><span class="se">\n</span><span class="s2">Install matplotlib to&quot;</span>
                <span class="s2">&quot;plot spatial classifier.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;fmt&quot;</span> <span class="ow">in</span> <span class="n">legend_kwds</span><span class="p">:</span>
            <span class="n">legend_kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fmt&quot;</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">_cl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;_cl&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">border_color</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">border_width</span><span class="p">,</span>
            <span class="n">scheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
            <span class="n">legend_kwds</span><span class="o">=</span><span class="n">legend_kwds</span><span class="p">,</span>
            <span class="n">classification_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bins&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">},</span>  <span class="c1"># for UserDefined</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axis_on</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span></div>
</div>



<div class="viewcode-block" id="MaxP">
<a class="viewcode-back" href="../../generated/mapclassify.MaxP.html#mapclassify.MaxP">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MaxP</span><span class="p">(</span><span class="n">MapClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MaxP Map Classification. Based on Max-p regionalization algorithm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to classify.</span>
<span class="sd">    k : int (default K==5)</span>
<span class="sd">        Number of classes required.</span>
<span class="sd">    initial : int (default 1000)</span>
<span class="sd">        Number of initial solutions to use prior to swapping.</span>
<span class="sd">    seed1 : int (default 0)</span>
<span class="sd">        Random state for initial building process.</span>
<span class="sd">    seed2 : int (default 1)</span>
<span class="sd">        Random state for swapping process.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    yb : numpy.array</span>
<span class="sd">        :math:`(n,1)`, bin IDs for observations.</span>
<span class="sd">    bins : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the upper bounds of each class.</span>
<span class="sd">    k : int</span>
<span class="sd">        The number of classes.</span>
<span class="sd">    counts  : numpy.array</span>
<span class="sd">        :math:`(k,1)`, the number of observations falling in each class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; mp = mapclassify.MaxP(cal)</span>
<span class="sd">    &gt;&gt;&gt; mp.bins</span>
<span class="sd">    array([3.16000e+00, 1.26300e+01, 1.67000e+01, 2.04700e+01, 4.11145e+03])</span>

<span class="sd">    &gt;&gt;&gt; mp.counts.tolist()</span>
<span class="sd">    [18, 16, 3, 1, 20]</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MaxP.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.MaxP.html#mapclassify.MaxP.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">seed1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seed2</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not enough unique values in array to form </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> classes. &quot;</span>
                <span class="s2">&quot;All values in `y` are equal.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">initial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed1</span> <span class="o">=</span> <span class="n">seed1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed2</span> <span class="o">=</span> <span class="n">seed2</span>
        <span class="n">MapClassifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MaxP&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># find best of initial solutions</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">best_tss</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">var</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tss_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">solution</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">:</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="n">seeds</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">di</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">di</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">qi</span><span class="p">)</span> <span class="k">for</span> <span class="n">qi</span> <span class="ow">in</span> <span class="n">q</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed1</span><span class="p">)</span>
            <span class="n">rseeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="p">[</span><span class="n">remaining</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span> <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="p">[</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">seed</span><span class="p">])</span> <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">rseeds</span><span class="p">:</span>
                <span class="n">seed_id</span> <span class="o">=</span> <span class="n">rseeds</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">classes</span><span class="p">[</span><span class="n">seed_id</span><span class="p">]</span>
                <span class="n">growing</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">while</span> <span class="n">growing</span><span class="p">:</span>
                    <span class="n">current</span> <span class="o">=</span> <span class="n">classes</span><span class="p">[</span><span class="n">seed_id</span><span class="p">]</span>
                    <span class="n">low</span> <span class="o">=</span> <span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">high</span> <span class="o">=</span> <span class="n">current</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">low</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">high</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">move_made</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">left</span> <span class="ow">in</span> <span class="n">remaining</span><span class="p">:</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="p">)</span>
                        <span class="n">remaining</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
                        <span class="n">move_made</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">remaining</span><span class="p">:</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
                        <span class="n">remaining</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
                        <span class="n">move_made</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">move_made</span><span class="p">:</span>
                        <span class="n">classes</span><span class="p">[</span><span class="n">seed_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">growing</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">tss</span> <span class="o">=</span> <span class="n">_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
            <span class="n">tss_all</span><span class="p">[</span><span class="n">solution</span><span class="p">]</span> <span class="o">=</span> <span class="n">tss</span>
            <span class="k">if</span> <span class="n">tss</span> <span class="o">&lt;</span> <span class="n">best_tss</span><span class="p">:</span>
                <span class="n">best_solution</span> <span class="o">=</span> <span class="n">classes</span>
                <span class="n">best_it</span> <span class="o">=</span> <span class="n">solution</span>
                <span class="n">best_tss</span> <span class="o">=</span> <span class="n">tss</span>
            <span class="n">solution</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">best_solution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_it</span> <span class="o">=</span> <span class="n">best_it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tss</span> <span class="o">=</span> <span class="n">best_tss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2c</span> <span class="o">=</span> <span class="n">a2c</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tss_all</span> <span class="o">=</span> <span class="n">tss_all</span>
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cl</span><span class="p">:</span>
                <span class="n">a2c</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
        <span class="n">swapping</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">swapping</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed2</span><span class="p">)</span>
            <span class="n">rseeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">total_moves</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">rseeds</span><span class="p">:</span>
                <span class="n">_id</span> <span class="o">=</span> <span class="n">rseeds</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">growing</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">total_moves</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">growing</span><span class="p">:</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">classes</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">n_moves</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">left</span> <span class="ow">in</span> <span class="n">a2c</span><span class="p">:</span>
                        <span class="n">left_class</span> <span class="o">=</span> <span class="n">classes</span><span class="p">[</span><span class="n">a2c</span><span class="p">[</span><span class="n">left</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_class</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">a</span> <span class="o">=</span> <span class="n">left_class</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_swap</span><span class="p">(</span><span class="n">left_class</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                                <span class="n">target</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                                <span class="n">left_class</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                                <span class="n">a2c</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">_id</span>
                                <span class="n">n_moves</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">a2c</span><span class="p">:</span>
                        <span class="n">right_class</span> <span class="o">=</span> <span class="n">classes</span><span class="p">[</span><span class="n">a2c</span><span class="p">[</span><span class="n">right</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_class</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">a</span> <span class="o">=</span> <span class="n">right_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_swap</span><span class="p">(</span><span class="n">right_class</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                                <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                                <span class="n">right_class</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                                <span class="n">n_moves</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">a2c</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">_id</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">n_moves</span><span class="p">:</span>
                        <span class="n">growing</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">total_moves</span> <span class="o">+=</span> <span class="n">n_moves</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">total_moves</span><span class="p">:</span>
                <span class="n">swapping</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xs</span><span class="p">[</span><span class="n">cl</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_def</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates sum of squares for a class.&quot;&quot;&quot;</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">class_def</span><span class="p">]</span>
        <span class="n">css</span> <span class="o">=</span> <span class="n">yc</span> <span class="o">-</span> <span class="n">yc</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">css</span> <span class="o">*=</span> <span class="n">css</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">css</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class1</span><span class="p">,</span> <span class="n">class2</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate cost of moving ``a`` from ``class1`` to ``class2``.&quot;&quot;&quot;</span>
        <span class="n">ss1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="p">(</span><span class="n">class1</span><span class="p">)</span>
        <span class="n">ss2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="p">(</span><span class="n">class2</span><span class="p">)</span>
        <span class="n">tss1</span> <span class="o">=</span> <span class="n">ss1</span> <span class="o">+</span> <span class="n">ss2</span>
        <span class="n">class1c</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">class1</span><span class="p">)</span>
        <span class="n">class2c</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">class2</span><span class="p">)</span>
        <span class="n">class1c</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">class2c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">ss1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="p">(</span><span class="n">class1c</span><span class="p">)</span>
        <span class="n">ss2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="p">(</span><span class="n">class2c</span><span class="p">)</span>
        <span class="n">tss2</span> <span class="o">=</span> <span class="n">ss1</span> <span class="o">+</span> <span class="n">ss2</span>

        <span class="k">return</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">tss1</span> <span class="o">&lt;</span> <span class="n">tss2</span> <span class="k">else</span> <span class="kc">True</span>  <span class="c1"># noqa SIM211</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the total sum of squares for a</span>
<span class="sd">    vector :math:`y` classified into classes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, variable to be classified.</span>
<span class="sd">    classes : array</span>
<span class="sd">        :math:`(k,1)`, integer values denoting class membership.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tss</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">class_def</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">class_def</span><span class="p">]</span>
        <span class="n">css</span> <span class="o">=</span> <span class="n">yc</span> <span class="o">-</span> <span class="n">yc</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">css</span> <span class="o">*=</span> <span class="n">css</span>
        <span class="n">tss</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">css</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tss</span>


<span class="n">kmethods</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">kmethods</span><span class="p">[</span><span class="s2">&quot;Quantiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Quantiles</span>
<span class="n">kmethods</span><span class="p">[</span><span class="s2">&quot;FisherJenks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FisherJenks</span>
<span class="n">kmethods</span><span class="p">[</span><span class="s2">&quot;NaturalBreaks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NaturalBreaks</span>
<span class="n">kmethods</span><span class="p">[</span><span class="s2">&quot;MaximumBreaks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MaximumBreaks</span>


<div class="viewcode-block" id="gadf">
<a class="viewcode-back" href="../../generated/mapclassify.gadf.html#mapclassify.gadf">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gadf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Quantiles&quot;</span><span class="p">,</span> <span class="n">maxk</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">pct</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the Goodness of Absolute Deviation Fit (*GADF*) of a classifier and</span>
<span class="sd">    find the minimum value of :math:`k` for which ``gadf &gt; pct``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n, 1)`, values to be classified.</span>
<span class="sd">    method : str (default &#39;Quantiles&#39;)</span>
<span class="sd">        The classification method in:</span>
<span class="sd">        ``{&#39;Quantiles&#39;, &#39;Fisher_Jenks&#39;, &#39;Maximum_Breaks&#39;, &#39;Natrual_Breaks&#39;}``.</span>
<span class="sd">    maxk : int (default 15)</span>
<span class="sd">        Maximum value of :math:`k` to evaluate.</span>
<span class="sd">    pct : float (default 0.8)</span>
<span class="sd">        The percentage of *GADF* to exceed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    k : int</span>
<span class="sd">        Number of classes.</span>
<span class="sd">    cl : object</span>
<span class="sd">        Instance of the classifier at :math:`k`.</span>
<span class="sd">    gadf : float</span>
<span class="sd">        Goodness of absolute deviation fit (*GADF*).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; qgadf = mapclassify.classifiers.gadf(cal)</span>
<span class="sd">    &gt;&gt;&gt; qgadf[0]</span>
<span class="sd">    15</span>

<span class="sd">    &gt;&gt;&gt; float(qgadf[-1])</span>
<span class="sd">    0.3740257590909283</span>

<span class="sd">    Quantiles fail to exceed 0.80 before 15 classes. If we lower the bar to</span>
<span class="sd">    0.2 we see quintiles as a result</span>

<span class="sd">    &gt;&gt;&gt; qgadf2 = mapclassify.classifiers.gadf(cal, pct = 0.2)</span>
<span class="sd">    &gt;&gt;&gt; qgadf2[0]</span>
<span class="sd">    5</span>

<span class="sd">    &gt;&gt;&gt; float(qgadf2[-1])</span>
<span class="sd">    0.21710231966462412</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The *GADF* is defined as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        GADF = 1 - \sum_c \sum_{i \in c}</span>
<span class="sd">               |y_i - y_{c,med}|  / \sum_i |y_i - y_{med}|</span>

<span class="sd">    where :math:`y_{med}` is the global median and :math:`y_{c,med}` is</span>
<span class="sd">    the median for class :math:`c`.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    KClassifiers</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">adam</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">maxk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">kmethods</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">gadf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cl</span><span class="o">.</span><span class="n">adcm</span> <span class="o">/</span> <span class="n">adam</span>
        <span class="k">if</span> <span class="n">gadf</span> <span class="o">&gt;</span> <span class="n">pct</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">gadf</span><span class="p">)</span></div>



<div class="viewcode-block" id="KClassifiers">
<a class="viewcode-back" href="../../generated/mapclassify.KClassifiers.html#mapclassify.KClassifiers">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KClassifiers</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate all :math:`k`-classifers and pick optimal based on :math:`k` and *GADF*.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    y : numpy.array</span>
<span class="sd">        :math:`(n,1)`, values to be classified.</span>
<span class="sd">    pct : float (default 0.8)</span>
<span class="sd">        The percentage of *GADF* to exceed.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    best : MapClassifier</span>
<span class="sd">        Instance of the optimal ``MapClassifier``.</span>
<span class="sd">    results : dict</span>
<span class="sd">        Keys are classifier names, values are the ``MapClassifier``</span>
<span class="sd">        instances with the best ``pct`` for each classifier.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mapclassify</span>
<span class="sd">    &gt;&gt;&gt; cal = mapclassify.load_example()</span>
<span class="sd">    &gt;&gt;&gt; ks = mapclassify.classifiers.KClassifiers(cal)</span>
<span class="sd">    &gt;&gt;&gt; ks.best.name</span>
<span class="sd">    &#39;FisherJenks&#39;</span>

<span class="sd">    &gt;&gt;&gt; ks.best.k</span>
<span class="sd">    4</span>

<span class="sd">    &gt;&gt;&gt; float(ks.best.gadf)</span>
<span class="sd">    0.8481032719908105</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This can be used to suggest a classification scheme.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    gadf</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="KClassifiers.__init__">
<a class="viewcode-back" href="../../generated/mapclassify.KClassifiers.html#mapclassify.KClassifiers.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pct</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">best</span> <span class="o">=</span> <span class="n">gadf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;FisherJenks&quot;</span><span class="p">,</span> <span class="n">maxk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pct</span><span class="o">=</span><span class="n">pct</span><span class="p">)</span>
        <span class="n">pct0</span> <span class="o">=</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">k0</span> <span class="o">=</span> <span class="n">best</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kmethods</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;FisherJenks&quot;</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;FisherJenks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">gadf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">maxk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pct</span><span class="o">=</span><span class="n">pct</span><span class="p">)</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pct1</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k1</span> <span class="o">&lt;</span> <span class="n">k0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k1</span> <span class="o">==</span> <span class="n">k0</span> <span class="ow">and</span> <span class="n">pct0</span> <span class="o">&lt;</span> <span class="n">pct1</span><span class="p">):</span>
                <span class="n">best</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
                <span class="n">k0</span> <span class="o">=</span> <span class="n">k1</span>
                <span class="n">pct0</span> <span class="o">=</span> <span class="n">pct1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best</span> <span class="o">=</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>
</div>

</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018-, pysal developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 8.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>